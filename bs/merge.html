<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>合并</title>
    <style>
        .img {
            height: 320px;
        }
    </style>
    <script src="static/js/jquery-1.4.4.min.js"></script>
    <script>
        function createElement (data) {
            let div = document.getElementById('records');
            let innerHTML = [];
            for (let i = 0; i < data['records'].length; i++) {
                let html = '<hr>'+
                        '<p>'+
                            '<label for="record_time"><strong>测点名称：</strong></label>'+
                            '<input type="text" readonly="readonly" id="point_name'+'_'+i+'">'+
                            '<label for="sampling_time"><strong>采样时间：</strong></label>'+
                            '<input type="text" readonly="readonly" id="sampling_time'+'_'+i+'">'+
                            '<label for="analyst"><strong>分析师：</strong></label>'+
                            '<input type="text" readonly="readonly" id="analyst'+'_'+i+'">'+
                        '</p>'+
                        '<p><img alt="" class="img" id="img_t'+'_'+i+'" src="" /></p>'+
                        '<strong>时域分析结果：</strong>' +
                        '<p id="ts'+'_'+i+'"></p>'+
                        '<p><img alt="" class="img" id="img_f'+'_'+i+'" src="" /></p>'+
                        '<strong>频域分析结果：</strong>' +
                        '<p id="freq'+'_'+i+'"></p>'+
                        '<p><img alt="" class="img" id="img_e'+'_'+i+'" src="" /></p>'+
                        '<strong>包络分析结果：</strong>' +
                        '<p id="env'+'_'+i+'"></p>'+
                        '<p><img alt="" class="img" id="img_1'+'_'+i+'" src="" /></p>'+
                        '<p><img alt="" class="img" id="img_2'+'_'+i+'" src="" /></p>'+
                        '<p><img alt="" class="img" id="img_3'+'_'+i+'" src="" /></p>'+
                        '<p><img alt="" class="img" id="img_4'+'_'+i+'" src="" /></p>'+
                        '<strong>趋势分析结果：</strong>' +
                        '<p id="trend'+'_'+i+'"></p>'+
                        '<strong>故障级别：</strong>' +
                        '<p id="level'+'_'+i+'"></p>';
                innerHTML.push(html);
            }
            div.innerHTML = innerHTML.join('');
        }

        function setValue (data) {
            for (let i = 0; i < data['records'].length; i++) {
                let point_name = data['records'][i][0];
                let record = data['records'][i][1];
                // 设置页面内容
                $('#point_name'+'_'+i).val(point_name);
                $('#sampling_time'+'_'+i).val(record['sampling_time']);
                $('#analyst'+'_'+i).val(record['analyst']);
                $('#ts'+'_'+i).html(record['ts']);
                $('#freq'+'_'+i).html(record['freq']);
                $('#env'+'_'+i).html(record['env']);
                $('#trend'+'_'+i).html(record['trend']);
                $('#level'+'_'+i).html(record['level']);
                $('#img_t'+'_'+i).attr('src', record['img_t']);
                $('#img_f'+'_'+i).attr('src', record['img_f']);
                $('#img_e'+'_'+i).attr('src', record['img_e']);
                $('#img_1'+'_'+i).attr('src', record['img_1']);
                $('#img_2'+'_'+i).attr('src', record['img_2']);
                $('#img_3'+'_'+i).attr('src', record['img_3']);
                $('#img_4'+'_'+i).attr('src', record['img_4']);
                // 当把图片保存到磁盘，并用图片的磁盘路径作为img的src属性时，启用以下代码
                // let merge_path = "{{ url_for('static', filename='temp/merge/') }}";
                // $('#img_t'+'_'+i).attr('src', merge_path+'img_t_'+i+'.png');
                // $('#img_f'+'_'+i).attr('src', merge_path+'img_f_'+i+'.png');
                // $('#img_e'+'_'+i).attr('src', merge_path+'img_e_'+i+'.png');
            }
        }

        // 调用父页面的函数
        let data = window.opener.getMergeData();
        // 当把图片保存到磁盘，并用图片的磁盘路径作为img的src属性时，启用以下代码
        // data['records'] = JSON.parse(data['records']);

        $(document).ready(function () {
            $('#farm').val(data['farm_name']);
            $('#wind_turbine').val(data['wind_turbine_name']);
            $('#date').val(data['date']);
            createElement(data);
            setValue(data);
        });
    </script>
</head>
<body>
    <div>
        <p>
            <label for="farm"><strong>风场：</strong></label>
            <input type="text" readonly="readonly" id="farm">
            <label for="wind_turbine"><strong>风机：</strong></label>
            <input type="text" readonly="readonly" id="wind_turbine">
            <label for="date"><strong>日期：</strong></label>
            <input type="text" readonly="readonly" id="date">
        </p>
    </div>
    <div id="records"></div>
</body>
</html>